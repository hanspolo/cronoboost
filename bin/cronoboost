#!/usr/bin/env ruby

require 'optparse'
require 'daemons'
require 'bundler'
Bundler.require(:default, :development)

# Setup the instance
inst = Cronoboost::Setup.run

# Parse options, allow many parameters to be used by the caller of this script
options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: example.rb [options]"

  opts.on("-v", "--[no-]verbose", "Run verbosely") do |v|
    options[:verbose] = v
  end

  opts.on("-h", "--help", "Prints this help") do
    puts opts
    exit
  end

  opts.on("-d", "--daemonize", "Runs the script in background") do
    Daemons.daemonize
  end
end.parse!

# Run the Worker loop
loop do
  Cronoboost::Worker.run inst
  sleep(5)
end
